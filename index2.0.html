<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Management & Store System</title>
  <style>
    :root {
      --primary-bg: #0b1220;
      --secondary-bg: #1a2338;
      --table-bg: #101a2f;
      --card-bg: #101a2f;
      --accent: #4db8ff;
      --warning: orange;
      --danger: red;
      --success: #4caf50;
      --text: #fff;
      --border-radius: 6px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: var(--primary-bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, sans-serif;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Header and Navigation */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      margin-bottom: 30px;
      border-bottom: 1px solid #2a3655;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--accent);
    }
    
    .nav-buttons {
      display: flex;
      gap: 10px;
    }
    
    .nav-btn {
      padding: 10px 15px;
      background: var(--secondary-bg);
      color: var(--text);
      border: 1px solid #3e567a;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .nav-btn:hover, .nav-btn.active {
      background: var(--accent);
      color: var(--primary-bg);
    }
    
    .cart-icon {
      position: relative;
      font-size: 24px;
      cursor: pointer;
    }
    
    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--accent);
      color: var(--primary-bg);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* Login Styles */
    .login-box {
      background: var(--secondary-bg);
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input, button, select {
      padding: 10px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      width: 100%;
    }
    
    input {
      background: #2a3655;
      color: var(--text);
      border: 1px solid #3e567a;
    }
    
    input:focus {
      outline: 2px solid var(--accent);
    }
    
    button {
      background: var(--accent);
      color: var(--primary-bg);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    .password-container {
      position: relative;
    }
    
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #aaa;
      width: auto;
      padding: 0;
      cursor: pointer;
    }
    
    /* App Sections */
    .app-section {
      display: none;
      background: var(--secondary-bg);
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
    }
    
    .app-section.active {
      display: block;
    }
    
    h2 {
      margin-top: 0;
      color: var(--accent);
      text-align: center;
    }
    
    /* Inventory Management Styles */
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .action-buttons button {
      flex: 1;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-warning {
      background: var(--warning);
      color: black;
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .search-box {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }
    
    .search-box input {
      flex: 1;
    }
    
    .search-box button {
      width: auto;
    }
    
    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
      background: var(--table-bg);
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #333;
    }
    
    th {
      color: var(--accent);
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    
    th:hover {
      background: #1c2b47;
    }
    
    th::after {
      content: '↕';
      position: absolute;
      right: 8px;
      opacity: 0.5;
    }
    
    th.asc::after {
      content: '↑';
      opacity: 1;
    }
    
    th.desc::after {
      content: '↓';
      opacity: 1;
    }
    
    .action-btn {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      width: auto;
    }
    
    .edit {
      background: var(--warning);
      color: #000;
    }
    
    .delete {
      background: var(--danger);
      color: #fff;
    }
    
    .low-stock {
      color: var(--warning);
      font-weight: bold;
    }
    
    .stats-bar {
      display: flex;
      justify-content: space-between;
      margin: 15px 0;
      padding: 10px;
      background: #152238;
      border-radius: var(--border-radius);
    }
    
    .sort-options {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .sort-options select {
      flex: 1;
    }
    
    .export-import {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .export-import button {
      width: auto;
      flex: 1;
    }
    
    /* Store Styles */
    .search-container {
      display: flex;
      margin-bottom: 30px;
      gap: 10px;
    }
    
    .search-input {
      flex: 1;
      padding: 12px 15px;
      background: #2a3655;
      color: var(--text);
      border: 1px solid #3e567a;
      border-radius: var(--border-radius);
      font-size: 16px;
    }
    
    .search-input:focus {
      outline: 2px solid var(--accent);
    }
    
    .search-btn {
      padding: 12px 20px;
      background: var(--accent);
      color: var(--primary-bg);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .search-btn:hover {
      background: #3aa0e0;
    }
    
    .clear-search {
      padding: 12px 15px;
      background: #555;
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
    }
    
    .clear-search:hover {
      background: #666;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .product-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    
    .product-image {
      width: 100%;
      height: 180px;
      background: #2a3655;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
    }
    
    .product-info {
      padding: 15px;
    }
    
    .product-name {
      font-size: 18px;
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .product-price {
      color: var(--accent);
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .product-stock {
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    .low-stock {
      color: var(--warning);
      font-weight: bold;
    }
    
    .out-of-stock {
      color: var(--danger);
      font-weight: bold;
    }
    
    .buy-btn {
      width: 100%;
      padding: 10px;
      background: var(--accent);
      color: var(--primary-bg);
      border: none;
      border-radius: var(--border-radius);
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .buy-btn:hover {
      background: #3aa0e0;
    }
    
    .buy-btn:disabled {
      background: #555;
      cursor: not-allowed;
    }
    
    .cart-modal {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      height: 100vh;
      background: var(--secondary-bg);
      box-shadow: -5px 0 15px rgba(0,0,0,0.5);
      transition: right 0.3s;
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .cart-modal.open {
      right: 0;
    }
    
    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #2a3655;
    }
    
    .close-cart {
      background: none;
      border: none;
      color: var(--text);
      font-size: 24px;
      cursor: pointer;
    }
    
    .cart-items {
      margin-bottom: 20px;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #2a3655;
    }
    
    .item-details {
      flex: 1;
    }
    
    .item-name {
      font-weight: bold;
    }
    
    .item-price {
      color: var(--accent);
    }
    
    .item-quantity {
      display: flex;
      align-items: center;
    }
    
    .quantity-btn {
      background: #2a3655;
      border: none;
      color: var(--text);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .quantity-value {
      margin: 0 10px;
      width: 30px;
      text-align: center;
    }
    
    .remove-item {
      background: none;
      border: none;
      color: var(--danger);
      cursor: pointer;
      margin-left: 10px;
    }
    
    .cart-total {
      font-size: 20px;
      font-weight: bold;
      margin: 20px 0;
      text-align: right;
    }
    
    .checkout-btn {
      width: 100%;
      padding: 15px;
      background: var(--success);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .checkout-btn:hover {
      background: #3d8b40;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 999;
    }
    
    .overlay.open {
      display: block;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px;
      border-radius: var(--border-radius);
      color: white;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s;
      z-index: 1000;
    }
    
    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--danger);
    }
    
    .empty-cart {
      text-align: center;
      padding: 30px;
      color: #aaa;
    }
    
    .no-products {
      text-align: center;
      padding: 40px;
      color: #aaa;
      grid-column: 1 / -1;
    }
    
    @media (max-width: 768px) {
      .action-buttons {
        flex-direction: column;
      }
      
      th, td {
        padding: 8px 5px;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: 10px;
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
      
      .cart-modal {
        width: 100%;
        right: -100%;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      header {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-buttons {
        width: 100%;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div class="container" id="loginPage">
    <div class="login-box">
      <h2>Inventory System Login</h2>
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Enter username">
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-container">
          <input type="password" id="password" placeholder="Enter password">
          <button class="toggle-password" id="togglePassword">👁</button>
        </div>
      </div>
      <button id="loginBtn">Login</button>
      <p id="error" style="color:red;display:none;margin-top:15px;">Invalid credentials. Please try again.</p>
    </div>
  </div>

  <!-- Main App (hidden until login) -->
  <div class="container" id="app" style="display: none;">
    <header>
      <div class="logo">Inventory Management System</div>
      <div class="nav-buttons">
        <button class="nav-btn active" id="inventoryBtn">Inventory</button>
        <button class="nav-btn" id="storeBtn">Product Store</button>
      </div>
      <div class="cart-icon" id="cartIcon">
        🛒
        <div class="cart-count" id="cartCount">0</div>
      </div>
    </header>

    <!-- Inventory Management Section -->
    <div class="app-section active" id="inventorySection">
      <h2>Inventory Management</h2>
      
      <div class="action-buttons">
        <button id="addItemBtn">➕ Add New Item</button>
        <button id="clearAllBtn" class="btn-danger">🗑 Clear All Items</button>
      </div>
      
      <div id="itemForm" style="display: none;">
        <h3 id="formTitle">Add New Item</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
          <div class="form-group">
            <label for="itemName">Item Name</label>
            <input type="text" id="itemName" placeholder="Item name">
          </div>
          <div class="form-group">
            <label for="itemQty">Quantity</label>
            <input type="number" id="itemQty" placeholder="Quantity" min="0">
          </div>
          <div class="form-group">
            <label for="itemPrice">Price (₹)</label>
            <input type="number" id="itemPrice" placeholder="Price" min="0" step="0.01">
          </div>
        </div>
        <div style="display: flex; gap: 10px;">
          <button id="saveBtn" class="btn-success">💾 Save Item</button>
          <button id="cancelBtn" class="btn-danger">✖ Cancel</button>
        </div>
      </div>
      
      <div class="stats-bar">
        <div>Total Items: <span id="totalItems">0</span></div>
        <div>Total Value: ₹<span id="totalValue">0</span></div>
        <div>Low Stock Items: <span id="lowStockCount">0</span></div>
      </div>
      
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="🔍 Search items...">
        <button id="searchInventoryBtn">Search</button>
        <button id="resetSearchBtn">Reset</button>
      </div>
      
      <div class="sort-options">
        <select id="sortBy">
          <option value="name">Sort by Name</option>
          <option value="qty">Sort by Quantity</option>
          <option value="price">Sort by Price</option>
          <option value="value">Sort by Value</option>
        </select>
        <select id="sortOrder">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
        <button id="sortBtn">Sort</button>
      </div>
      
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th data-sort="name">Item</th>
              <th data-sort="qty">Qty</th>
              <th data-sort="price">Price</th>
              <th data-sort="value">Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      
      <div class="export-import">
        <button id="exportBtn">📤 Export Data</button>
        <button id="importBtn">📥 Import Data</button>
        <input type="file" id="importFile" accept=".json" style="display: none;">
      </div>
    </div>

    <!-- Product Store Section -->
    <div class="app-section" id="storeSection">
      <h2>Our Products</h2>
      
      <div class="search-container">
        <input type="text" class="search-input" id="storeSearchInput" placeholder="🔍 Search products by name...">
        <button class="search-btn" id="storeSearchBtn">Search</button>
        <button class="clear-search" id="storeClearSearch">Clear</button>
      </div>
      
      <div class="products-grid" id="productsGrid">
        <!-- Products will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="cart-modal" id="cartModal">
    <div class="cart-header">
      <h2>Your Cart</h2>
      <button class="close-cart" id="closeCart">×</button>
    </div>
    
    <div class="cart-items" id="cartItems">
      <div class="empty-cart">Your cart is empty</div>
    </div>
    
    <div class="cart-total" id="cartTotal">
      Total: ₹0.00
    </div>
    
    <button class="checkout-btn" id="checkoutBtn">Checkout</button>
  </div>
  
  <div class="overlay" id="overlay"></div>
  
  <div class="notification" id="notification"></div>

  <script>
    // Constants and variables
    const USER = "suraj", PASS = "8601386Sk";
    let inventory = [], editIndex = -1, filtered = [], currentSort = { field: 'name', order: 'asc' };
    let cart = [];
    let isSearching = false;
    let filteredProducts = [];
    
    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Login functionality
      document.getElementById("loginBtn").addEventListener("click", login);
      document.getElementById("password").addEventListener("keypress", function(e) {
        if (e.key === 'Enter') login();
      });
      
      // Toggle password visibility
      document.getElementById("togglePassword").addEventListener("click", function() {
        const passwordInput = document.getElementById("password");
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.textContent = type === 'password' ? '👁' : '🔒';
      });
      
      // Navigation
      document.getElementById("inventoryBtn").addEventListener("click", () => showSection('inventory'));
      document.getElementById("storeBtn").addEventListener("click", () => showSection('store'));
      
      // Inventory functionality
      document.getElementById("addItemBtn").addEventListener("click", showItemForm);
      document.getElementById("saveBtn").addEventListener("click", saveItem);
      document.getElementById("cancelBtn").addEventListener("click", hideItemForm);
      document.getElementById("clearAllBtn").addEventListener("click", clearAllItems);
      document.getElementById("searchInventoryBtn").addEventListener("click", searchItems);
      document.getElementById("resetSearchBtn").addEventListener("click", resetSearch);
      document.getElementById("sortBtn").addEventListener("click", sortInventory);
      document.getElementById("exportBtn").addEventListener("click", exportData);
      document.getElementById("importBtn").addEventListener("click", importData);
      
      // Store functionality
      document.getElementById("storeSearchBtn").addEventListener("click", searchProducts);
      document.getElementById("storeClearSearch").addEventListener("click", clearSearch);
      document.getElementById("cartIcon").addEventListener("click", openCart);
      document.getElementById("closeCart").addEventListener("click", closeCart);
      document.getElementById("overlay").addEventListener("click", closeCart);
      document.getElementById("checkoutBtn").addEventListener("click", checkout);
      
      // Search when pressing Enter in search input
      document.getElementById("storeSearchInput").addEventListener("keypress", function(e) {
        if (e.key === 'Enter') searchProducts();
      });
      
      // Import file handler
      document.getElementById("importFile").addEventListener("change", handleFileImport);
      
      // Table header sorting
      document.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => sortTable(th.getAttribute('data-sort')));
      });
    });
    
    // Login function
    function login() {
      let u = document.getElementById("username").value.trim();
      let p = document.getElementById("password").value.trim();
      
      if (u === USER && p === PASS) {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("app").style.display = "block";
        showNotification("Login successful!", "success");
        loadInventory();
      } else {
        document.getElementById("error").style.display = "block";
        setTimeout(() => {
          document.getElementById("error").style.display = "none";
        }, 3000);
      }
    }
    
    // Show/hide sections
    function showSection(section) {
      document.querySelectorAll('.app-section').forEach(sec => {
        sec.classList.remove('active');
      });
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (section === 'inventory') {
        document.getElementById('inventorySection').classList.add('active');
        document.getElementById('inventoryBtn').classList.add('active');
        loadInventory();
      } else if (section === 'store') {
        document.getElementById('storeSection').classList.add('active');
        document.getElementById('storeBtn').classList.add('active');
        loadProducts();
      }
    }
    
    // Inventory Management Functions
    function showItemForm() {
      document.getElementById("itemForm").style.display = "block";
      document.getElementById("addItemBtn").style.display = "none";
      document.getElementById("formTitle").textContent = "Add New Item";
      clearForm();
    }
    
    function hideItemForm() {
      document.getElementById("itemForm").style.display = "none";
      document.getElementById("addItemBtn").style.display = "block";
      editIndex = -1;
    }
    
    function clearForm() {
      document.getElementById("itemName").value = "";
      document.getElementById("itemQty").value = "";
      document.getElementById("itemPrice").value = "";
    }
    
    function saveInventory() {
      localStorage.setItem("invData", JSON.stringify(inventory));
    }
    
    function loadInventory() {
      let d = localStorage.getItem("invData");
      if (d) {
        try {
          inventory = JSON.parse(d);
          renderTable();
          updateStats();
        } catch (e) {
          showNotification("Error loading inventory data", "error");
          inventory = [];
        }
      } else {
        inventory = [];
      }
    }
    
    function saveItem() {
      let name = document.getElementById("itemName").value.trim();
      let qty = parseInt(document.getElementById("itemQty").value);
      let price = parseFloat(document.getElementById("itemPrice").value);
      
      // Validation
      if (!name) {
        showNotification("Please enter an item name", "error");
        document.getElementById("itemName").focus();
        return;
      }
      
      if (isNaN(qty) || qty < 0) {
        showNotification("Please enter a valid quantity", "error");
        document.getElementById("itemQty").focus();
        return;
      }
      
      if (isNaN(price) || price < 0) {
        showNotification("Please enter a valid price", "error");
        document.getElementById("itemPrice").focus();
        return;
      }
      
      let value = qty * price;
      let obj = { name, qty, price, value };
      
      if (editIndex >= 0) {
        inventory[editIndex] = obj;
        showNotification("Item updated successfully", "success");
      } else {
        inventory.push(obj);
        showNotification("Item added successfully", "success");
      }
      
      saveInventory();
      renderTable();
      updateStats();
      hideItemForm();
    }
    
    function renderTable(list = inventory) {
      let tb = document.getElementById("tableBody");
      tb.innerHTML = "";
      
      if (list.length === 0) {
        tb.innerHTML = `<tr><td colspan="5" style="text-align: center;">No items found</td></tr>`;
        return;
      }
      
      list.forEach((item, i) => {
        let tr = document.createElement("tr");
        
        // Add low stock class if quantity is 5 or less
        const lowStockClass = item.qty <= 5 ? "low-stock" : "";
        
        tr.innerHTML = `<td>${item.name}</td>
                        <td class="${lowStockClass}">${item.qty}</td>
                        <td>₹${item.price.toFixed(2)}</td>
                        <td>₹${item.value.toFixed(2)}</td>
                        <td></td>`;
        
        let actionTd = tr.lastElementChild;
        actionTd.style.whiteSpace = "nowrap";
        
        let ebtn = document.createElement("button");
        ebtn.textContent = "✏ Edit";
        ebtn.className = "action-btn edit";
        ebtn.addEventListener("click", () => editItem(i, list));
        
        let dbtn = document.createElement("button");
        dbtn.textContent = "🗑 Delete";
        dbtn.className = "action-btn delete";
        dbtn.addEventListener("click", () => deleteItem(i, list));
        
        actionTd.appendChild(ebtn);
        actionTd.appendChild(dbtn);
        tb.appendChild(tr);
      });
    }
    
    function editItem(i, list) {
      let realIndex = inventory.indexOf(list[i]);
      document.getElementById("itemName").value = inventory[realIndex].name;
      document.getElementById("itemQty").value = inventory[realIndex].qty;
      document.getElementById("itemPrice").value = inventory[realIndex].price;
      
      editIndex = realIndex;
      document.getElementById("formTitle").textContent = "Edit Item";
      document.getElementById("itemForm").style.display = "block";
      document.getElementById("addItemBtn").style.display = "none";
    }
    
    function deleteItem(i, list) {
      if (confirm("Are you sure you want to delete this item?")) {
        let realIndex = inventory.indexOf(list[i]);
        inventory.splice(realIndex, 1);
        saveInventory();
        renderTable();
        updateStats();
        showNotification("Item deleted successfully", "success");
      }
    }
    
    function clearAllItems() {
      if (inventory.length === 0) {
        showNotification("Inventory is already empty", "error");
        return;
      }
      
      if (confirm("Are you sure you want to clear ALL items? This cannot be undone.")) {
        inventory = [];
        saveInventory();
        renderTable();
        updateStats();
        showNotification("All items cleared", "success");
      }
    }
    
    function updateStats() {
      const totalItems = inventory.length;
      const totalValue = inventory.reduce((sum, item) => sum + item.value, 0);
      const lowStockCount = inventory.filter(item => item.qty <= 5).length;
      
      document.getElementById("totalItems").textContent = totalItems;
      document.getElementById("totalValue").textContent = totalValue.toFixed(2);
      document.getElementById("lowStockCount").textContent = lowStockCount;
    }
    
    function searchItems() {
      let q = document.getElementById("searchInput").value.toLowerCase();
      if (q === "") {
        renderTable();
        return;
      }
      
      filtered = inventory.filter(it => it.name.toLowerCase().includes(q));
      renderTable(filtered);
    }
    
    function resetSearch() {
      document.getElementById("searchInput").value = "";
      renderTable();
    }
    
    function sortTable(field) {
      // Toggle sort order if clicking the same field
      if (currentSort.field === field) {
        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.field = field;
        currentSort.order = 'asc';
      }
      
      // Remove previous sort indicators
      document.querySelectorAll('th').forEach(th => {
        th.classList.remove('asc', 'desc');
      });
      
      // Add sort indicator to current field
      const header = document.querySelector(`th[data-sort="${field}"]`);
      if (header) {
        header.classList.add(currentSort.order);
      }
      
      // Sort the inventory
      inventory.sort((a, b) => {
        let valA = a[field];
        let valB = b[field];
        
        // Handle string comparison
        if (typeof valA === 'string') {
          valA = valA.toLowerCase();
          valB = valB.toLowerCase();
        }
        
        if (valA < valB) return currentSort.order === 'asc' ? -1 : 1;
        if (valA > valB) return currentSort.order === 'asc' ? 1 : -1;
        return 0;
      });
      
      renderTable();
    }
    
    function sortInventory() {
      const field = document.getElementById("sortBy").value;
      const order = document.getElementById("sortOrder").value;
      
      currentSort.field = field;
      currentSort.order = order;
      
      inventory.sort((a, b) => {
        let valA = a[field];
        let valB = b[field];
        
        if (typeof valA === 'string') {
          valA = valA.toLowerCase();
          valB = valB.toLowerCase();
        }
        
        if (valA < valB) return order === 'asc' ? -1 : 1;
        if (valA > valB) return order === 'asc' ? 1 : -1;
        return 0;
      });
      
      renderTable();
    }
    
    function exportData() {
      if (inventory.length === 0) {
        showNotification("No data to export", "error");
        return;
      }
      
      const dataStr = JSON.stringify(inventory, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = 'inventory-data.json';
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
      
      showNotification("Data exported successfully", "success");
    }
    
    function importData() {
      document.getElementById("importFile").click();
    }
    
    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
          
          if (Array.isArray(importedData)) {
            if (confirm("This will replace your current inventory. Continue?")) {
              inventory = importedData;
              saveInventory();
              renderTable();
              updateStats();
              showNotification("Data imported successfully", "success");
            }
          } else {
            showNotification("Invalid file format", "error");
          }
        } catch (error) {
          showNotification("Error parsing file", "error");
        }
      };
      reader.readAsText(file);
      
      // Reset file input
      event.target.value = '';
    }
    
    // Store Functions
    function loadProducts() {
      // Use the same inventory data
      filteredProducts = [...inventory];
      renderProducts();
    }
    
    function searchProducts() {
      const searchTerm = document.getElementById('storeSearchInput').value.trim().toLowerCase();
      
      if (searchTerm === '') {
        filteredProducts = [...inventory];
        isSearching = false;
      } else {
        filteredProducts = inventory.filter(product => 
          product.name.toLowerCase().includes(searchTerm)
        );
        isSearching = true;
      }
      
      renderProducts();
    }
    
    function clearSearch() {
      document.getElementById('storeSearchInput').value = '';
      filteredProducts = [...inventory];
      isSearching = false;
      renderProducts();
    }
    
    function renderProducts() {
      const productsGrid = document.getElementById('productsGrid');
      productsGrid.innerHTML = '';
      
      if (filteredProducts.length === 0) {
        const noProductsMsg = isSearching 
          ? 'No products found matching your search' 
          : 'No products available';
        productsGrid.innerHTML = `<div class="no-products">${noProductsMsg}</div>`;
        return;
      }
      
      filteredProducts.forEach((product, index) => {
        // Find the original index in the main inventory array
        const originalIndex = inventory.findIndex(p => p.name === product.name);
        const productId = originalIndex !== -1 ? originalIndex : index;
        
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        
        // Determine stock status
        let stockClass = '';
        let stockText = '';
        
        if (product.qty === 0) {
          stockClass = 'out-of-stock';
          stockText = 'Out of stock';
        } else if (product.qty <= 5) {
          stockClass = 'low-stock';
          stockText = `Only ${product.qty} left`;
        } else {
          stockText = `${product.qty} in stock`;
        }
        
        productCard.innerHTML = `
          <div class="product-image">📦</div>
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-price">₹${product.price.toFixed(2)}</div>
            <div class="product-stock ${stockClass}">${stockText}</div>
            <button class="buy-btn" ${product.qty === 0 ? 'disabled' : ''} data-id="${productId}">
              ${product.qty === 0 ? 'Out of Stock' : 'Add to Cart'}
            </button>
          </div>
        `;
        
        productsGrid.appendChild(productCard);
      });
      
      // Add event listeners to buy buttons
      document.querySelectorAll('.buy-btn').forEach(button => {
        if (!button.disabled) {
          button.addEventListener('click', function() {
            const productId = parseInt(this.getAttribute('data-id'));
            addToCart(productId);
          });
        }
      });
    }
    
    function addToCart(productId) {
      const product = inventory[productId];
      
      // Check if product is already in cart
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        // Check if we can add more (stock limit)
        if (existingItem.quantity < product.qty) {
          existingItem.quantity += 1;
          showNotification(`Added another ${product.name} to cart`, 'success');
        } else {
          showNotification(`Cannot add more. Only ${product.qty} available.`, 'error');
          return;
        }
      } else {
        // Add new item to cart
        cart.push({
          id: productId,
          name: product.name,
          price: product.price,
          quantity: 1,
          maxQuantity: product.qty
        });
        showNotification(`Added ${product.name} to cart`, 'success');
      }
      
      // Save cart and update UI
      saveCart();
      updateCartUI();
    }
    
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      saveCart();
      updateCartUI();
      showNotification('Item removed from cart', 'success');
    }
    
    function updateQuantity(productId, change) {
      const item = cart.find(item => item.id === productId);
      
      if (item) {
        const newQuantity = item.quantity + change;
        
        if (newQuantity < 1) {
          removeFromCart(productId);
          return;
        }
        
        // Check if we exceed available stock
        if (newQuantity > item.maxQuantity) {
          showNotification(`Only ${item.maxQuantity} available in stock`, 'error');
          return;
        }
        
        item.quantity = newQuantity;
        saveCart();
        updateCartUI();
      }
    }
    
    function saveCart() {
      localStorage.setItem('storeCart', JSON.stringify(cart));
      updateCartUI();
    }
    
    function updateCartUI() {
      const cartCount = document.getElementById('cartCount');
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      
      // Update cart count
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      cartCount.textContent = totalItems;
      
      // Update cart items
      if (cart.length === 0) {
        cartItems.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
        cartTotal.textContent = 'Total: ₹0.00';
        return;
      }
      
      let itemsHTML = '';
      let total = 0;
      
      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        itemsHTML += `
          <div class="cart-item">
            <div class="item-details">
              <div class="item-name">${item.name}</div>
              <div class="item-price">₹${item.price.toFixed(2)} × ${item.quantity}</div>
            </div>
            <div class="item-quantity">
              <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
              <span class="quantity-value">${item.quantity}</span>
              <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
              <button class="remove-item" onclick="removeFromCart(${item.id})">🗑️</button>
            </div>
          </div>
        `;
      });
      
      cartItems.innerHTML = itemsHTML;
      cartTotal.textContent = `Total: ₹${total.toFixed(2)}`;
    }
    
    function openCart() {
      document.getElementById('cartModal').classList.add('open');
      document.getElementById('overlay').classList.add('open');
    }
    
    function closeCart() {
      document.getElementById('cartModal').classList.remove('open');
      document.getElementById('overlay').classList.remove('open');
    }
    
    function checkout() {
      if (cart.length === 0) {
        showNotification('Your cart is empty', 'error');
        return;
      }
      
      // Update inventory with purchased items
      cart.forEach(item => {
        if (inventory[item.id]) {
          inventory[item.id].qty -= item.quantity;
          inventory[item.id].value = inventory[item.id].qty * inventory[item.id].price;
        }
      });
      
      // Save updated inventory
      saveInventory();
      
      showNotification('Purchase successful! Inventory updated.', 'success');
      
      // Clear cart
      cart = [];
      saveCart();
      updateCartUI();
      
      // Refresh both views
      renderTable();
      updateStats();
      renderProducts();
      
      closeCart();
    }
    
    // Notification system
    function showNotification(message, type) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html>
